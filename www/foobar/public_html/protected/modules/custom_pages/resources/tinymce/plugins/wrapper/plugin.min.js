/**
 * plugin.js
 *
 * @link https://www.humhub.org/
 * @copyright Copyright (c) 2022 HumHub GmbH & Co. KG
 * @license https://www.humhub.com/licences
 * @author Lucas Bartholemy <lucas@bartholemy.com>
 */
tinymce.PluginManager.add("wrapper",(function(t,e){const s=t.getParam("wrapper"),i={items:[{tag:"div",class:"panel panel-default",style:"background:#ededed; padding:5px; margin:-1rem"},{tag:"div",class:"panel-body",style:"background:#fff; border-radius:4px; box-shadow:0 0 3px #dadada; padding:10px"}],wrap:function(t){return this.startHtml()+t+this.endHtml()},unwrap:function(t){const e=new RegExp("^"+this.regexp("(.+?)")+"$","is");return t.replace(e,"$1")}};t.ui.registry.addToggleButton("wrapper",{icon:"unselected",text:s.text,tooltip:s.tooltip,onAction:e=>{const s=t.getContent();i.isActive()?(t.setContent(i.unwrap(s)),e.setActive(!1)):(t.setContent(i.wrap(s)),e.setActive(!0)),t.focus()},onSetup:e=>{e.setActive(i.isActive()),t.on("NodeChange",(()=>{e.setActive(i.isActive()),i.cleanup()}))}}),i.isActive=function(){const e=t.dom.getRoot().childNodes;return 1===e.length&&t.dom.is(e[0],this.selector(0))&&1===e[0].childNodes.length&&t.dom.is(e[0].childNodes[0],this.selector(1))},i.startTag=function(t){if(void 0===this.items[t])return"";let e="<"+this.items[t].tag;return this.items[t].class&&(e+=' class="'+this.items[t].class+'"'),e+=">",e},i.endTag=function(t){return void 0===this.items[t]?"":"</"+this.items[t].tag+">"},i.startHtml=function(t){void 0===t&&(t="");let e="";for(let s=0;s<this.items.length;s++)e+=this.startTag(s),s<this.items.length-1&&(e+=t);return e},i.endHtml=function(t){void 0===t&&(t="");let e="";for(let s=this.items.length-1;s>=0;s--)e+=this.endTag(s),s>0&&(e+=t);return e},i.selector=function(t){const e=this.items[t];let s=e.tag;return e.class&&(s+="."+e.class.replace(" ",".")),s},i.regexp=function(t){return this.startHtml(".*?")+t+this.endHtml(".*?")},i.cleanup=function(){const e=t.getContent();let s=e;const i="<p>&nbsp;</p>",n=this.startTag(1)+"&nbsp;"+this.endTag(1),a="[\r\n]*";if(s.match(new RegExp(i,"i"))){const t="("+a+i+a+")*";s=s.replace(new RegExp("^"+t+"("+this.regexp(".+?")+")"+t+"$","is"),"$2")}s.match(new RegExp(n,"i"))&&(s=s.replace(new RegExp(this.endTag(1)+a+n,"ig"),i+this.endTag(1)).replace(new RegExp(this.startTag(0)+a+n,"ig"),this.startHtml()+i)),s!==e&&t.setContent(s)},i.initStyles=function(){let e="",s="";for(let t=0;t<this.items.length;t++)e+=s+this.selector(t)+" {"+this.items[t].style+"}",s=this.selector(t)+" ";t.contentStyles.push(e)},i.initStyles()}));
